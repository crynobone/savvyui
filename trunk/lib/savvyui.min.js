/**
 * Savvy.UI JavaScript Library v1.2.0-draft
 * Version: 1.2.0-a1
 * Author: Mior Muhammad Zaki crynobone@gmail.com 
 * 
 * Copyright (c) 2009 Mior Muhammad Zaki Mior Khairuddin
 * Licensed under the MIT
 *
 * Revision: r320
 */

var Js=window.Js=function(obj){return(this===window?new Js.create(obj):this)};Js.adapter='jQuery-1.3.2';Js.version='1.2.0-a3';Js.toString=function(){return['Savvy.UI','version',Js.version,'using',Js.adapter].join(' ')};Js.nue=function(data,num){var num=Js.on.pickType(num,1,'number');var type_of=Js.on.typeOf(data,'object');if(Js.on.inArray(type_of,['object','array'])){var result=(type_of=='object'?{}:[]);--num;for(var method in data){if(data.hasOwnProperty(method))result[method]=(num>0?Js.nue(data[method],num):data[method])}return result}else return data};Js.append=function(data,alt,define,invert){var define=Js.on.pickType(define,null,'array');var invert=Js.on.pickType(invert,false,'boolean');if(!Js.on.typeOf(data,'object'))data={};var result=data;for(var method in alt){var add=Js.on.isnull(define)||Js.on.inArray(method,define);var both=!data.hasOwnProperty(method)&&alt.hasOwnProperty(method);var add=(!!invert?!add:add);if(!!both&&!!add)result[method]=alt[method]}return result};Js.debug={enable:false,dev:false,data:{error:[],log:[]},value:{error:[],log:[]},log:function(text,value){var value=Js.on.pick(value,'');this.data.log.push(text);this.value.log.push(value);if(!!this.dev){try{if(value==='')console.log(text);else console.log(text,value)}catch(e){alert(text+value)}}},error:function(text,value){var value=Js.on.pick(value,'');this.data.error.push(text);this.value.error.push(value);if(!!this.enable||!!this.dev){try{if(value==='')console.log(text);else console.log(text,value)}catch(e){alert(text+value)}}}};Js.on={behaviour:function(){return function(){var win=window,doc=document;var browse={ie:false,ie6:false,ie7:false,khtml:false,gecko:false,opera:false};browse.ie=browse[win.XMLHttpRequest?"ie7":"ie6"]=!!win.ActiveXObject;browse.khtml=(doc.childNodes&&!doc.all&&!navigator.taintEnabled);browse.gecko=doc.getBoxObjectFor!=null;browse.opera=!!win.opera;return browse}()}(),camelize:function(data){var value=data.split(/\-/);if(value.length===1)return value[0];var result=(data.indexOf('-')==0?value[0].charAt(0).toUpperCase()+value[0].substr(1):value[0]);jQuery.each(value,function(index,val){if(index>0)result=[result,val.charAt(0).toUpperCase(),val.substr(1)].join('')});return result},filter:function(data,value){var result=[];jQuery.each(data,function(index,val){if(value.match(val))result.push(val)});return result},href:function(uri,target){if(this.trim(uri)!==''){if(this.isnull(target))window.location.href=uri;else window.open(uri,target)}else Js.debug.error('Js.on.href: failed to load page '+uri)},htmlEncode:function(text){return new String(text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\+/g,"&#43;")},htmlDecode:function(text){return new String(text).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#43;/g,"+")},inArray:function(value,data){var index=0;for(;index<data.length&&!!data[index];index++){if(data[index]===value){return true;break}}return false},inArrayGrep:function(value,data){var index=0;for(;index<data.length&&!!data[index];index++){if(data[index].match(value)){return true;break}}return false},'indexOf':function(value,data){var index=data.length;for(;index--&&data[index]!==value;);return index},indexOfGrep:function(value,data){var index=data.length;for(;index--&&!data[index].match(value););return index},isnull:function(value){return(typeof(value)=='undefined'||value==null)},isset:function(value){return!this.isnull(value)},isfunction:function(value){return this.typeOf(value,'function')},ltrim:function(value){return new String(value).replace(/^\s+/g,'')},parameter:function(data,length,expect){var data=jQuery.makeArray(data),expect=Js.on.pickType(expect,[],'array'),result=false;if(data.length===length){result=true;jQuery.each(data,function(index,val){if(expect[index]!==true&&Js.on.typeOf(val)!==expect[index])result=false})}return result},pick:function(){var data=jQuery.makeArray(arguments),index=0,result=null;var length=data.length;for(;index<length;index++){result=data[index];if(Js.on.isset(result)){return result;break}};return null},pickType:function(){var data=jQuery.makeArray(arguments),index=0,result=null;var length=data.length;var type=data[(length-1)];for(;index<(length-1);index++){var result=data[index];if(Js.on.isset(result)){if(this.typeOf(result,type)){return result;break}}};return null},pickGrep:function(){var data=jQuery.makeArray(arguments),index=0,result=null;var length=data.length;var regex=data[(length-1)];if(this.typeOf(regex)=="string")regex=new RegExp(regex);for(;index<(length-1);index++){result=data[index];if(Js.on.isset(result)){if(!!result.match(regex)){return result;break}}};return null},prettyList:function(data,between,last){var len=data.length,result=new String;if(len>1){jQuery.each(data,function(index,val){result=[result,(index==0?'':(index==(len-1)?last:between)),val].join('')})}else result=data[0];return result},replace:function(search,replace,data){var data=new String(data);var replace=Js.on.pickType(replace,'','string');return data.split(search).join(replace)},rtrim:function(value){return new String(value).replace(/\s$/g,'')},stripTags:function(value){return new String(value).replace(/<([^>]+)>/g,'')},toNumber:function(value){var value=this.replace(',','',value);return(typeof(value)=='string'?parseInt(value,10):value)},toFloat:function(value){var value=this.replace(',','',value);return(typeof(value)=='string'?parseFloat(value,10):value)},toProperCase:function(data){var value=data.split(/ /g),result=[],that=function(o){var o=o.toString();return[o.substr(0,1).toUpperCase(),o.substr(1)].join('')};jQuery.each(value,function(index,val){result.push(that(val))});return r.join(' ')},toArray:function(data,offset){var offset=(function(o){var o=Js.on.pickType(o,0,'number');return o<1?0:o})(offset);var len={offset:0,data:0};var result=[];if(this.isset(data)){len.offset=(data.length-offset);len.data=data.length;while(len.offset>0){--len.offset;--len.data;result[len.offset]=data[len.data]}}return result},trim:function(text){return jQuery.trim(text)},typeOf:function(data,type){var result=(function(data){if(Js.on.isnull(data))return'undefined';else{var value=Object.prototype.toString.call(data).match(/(\w+)\]/)[1];return(value=='HTMLDocument'?'element':value.toLowerCase())}})(data);return(Js.on.isset(type)?(result===type.toLowerCase()):result)},unique:function(data,repeat){var repeat=this.pickType(repeat,false,'boolean');var result=[];jQuery.each(data,function(index,value){if(!repeat){if(!Js.on.inArray(value,result))result.push(value)}else{if(index==0||value!==Js.on.trim(data[i-1]))result.push(value)}});return result},prep:function(data){return(data.match(/^(#|\.)?(.*)$/gi)?RegExp.$2:data)}};Js.ext={};Js.util={};Js.widget={};Js.create=function(obj){var obj=Js.on.pickType(obj,{},"object");var base=function(){};base.prototype.destroy=function(){for(var method in this)this[method]=null;for(var method in this.prototype)this.prototype[method]=null;delete this;return null};var initd=true;var proto=new base;initd=false;function Class(){if(!initd&&!!this.initiate)this.initiate.apply(this,Js.on.toArray(arguments))};Class.prototype=proto;Class.prototype.initiate=Js.on.pick(obj.initiate,obj.__construct,null);Class.constructor=Class;Class.prototype.$inject=function(fn){if(Js.on.isfunction(fn))return fn.apply(this,Js.on.toArray(arguments,1))};Class.prototype.$const=(function(object){var $const={};if(Js.on.typeOf(object.Const)=="object"){var $const=Js.nue(object.Const);delete object.Const}return(function(fn){if(Js.on.typeOf(fn)=="string"){if(Js.on.isfunction($const[fn]))return $const[fn].apply(this,Js.on.toArray(arguments,1));else return $const[fn]}})})(obj);Class.extend=function(obj){obj.Extend=this;return Js.create(obj)};var Extend=Js.on.pick(obj.Extend,null);(function(proto){var not=["Extend","__construct","__destruct","$super","prototype"];for(var method in proto){if(proto.hasOwnProperty(method)&&(!Js.on.inArray(method,not)&&!this[method]))this[method]=proto[method]}}).call(proto,obj);if(!!Js.on.isset(Extend)){try{(function(proto){var not=["Extend","__construct","__destruct","$super","prototype"];for(var method in proto.prototype){if(proto.prototype.hasOwnProperty(method)&&(!Js.on.inArray(method,not)&&!this[method]))this[method]=proto.prototype[method]}for(var method in proto){if(proto.hasOwnProperty(method)&&!Js.on.inArray(method,not)){if(!this[method])this[method]=proto[method]}}this.$super=proto.prototype}).call(proto,Extend)}catch(e){Js.debug.error('Js.create: failed '+e)}Class.prototype.$parent=function(fn){return this.$super[fn].apply(this,Js.on.toArray(arguments,1))}}delete Extend;delete obj;return Class};jQuery.fn.extend({setClass:function(v){return this.each(function(){this.className=v})},htmlText:function(tx){if(tx==undefined)return(this[0]?this[0].innerHTML:null);else{this.each(function(){this.innerHTML=tx});return this}}});Js.$=window.jQuery;Js.config={ext:{validate:{errorNode:'span.form-error-message',beforeStart:null,success:null,onError:null,auto:true}},test:{email:/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,url:/^https?:\/\/([a-z0-9-]+\.)+[a-z0-9]{2,4}.*$/,ip:/^\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\]$/,username:/^([a-zA-Z0-9_\.\-\+])$/,postcode:/^\d{5}$/},util:{formSubmit:{method:'POST',beforeStart:null,beforeSend:null,formSuccess:null,sendSuccess:null,onError:null,onSendError:null},buttonSubmit:{method:'POST',beforeStart:null,beforeSend:null,formSuccess:null,sendSuccess:null,onError:null,onSendError:null},editable:{identifier:'Other',prefix:'',beforeStart:null,onBeforeUpdate:null,onUpdate:null,overlay:true}},widget:{activity:{imagePath:'images/',boxWidth:200,boxHeight:20,identifier:'.widget-activity',opacity:0.3,background:'#fff',zIndex:5000},datePicker:{daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],dateFormat:/^(\d{2}|\d{4})[.\/-](\d{1,2})[.\/-](\d{1,2})$/,onUpdate:null,navigation:true,fieldType:'hidden',beforeStart:null},dropmenu:{speed:250,zIndex:100,css:'widget-dropmenu'},iconizer:{fileType:'png',folder:'icons/'},message:{identifier:'#overlay-message',cssSuccess:'message-success',cssNote:'message-note',cssError:'message-error',seconds:5},notice:{cssSuccess:'notice-success',cssNote:'notice-note',cssError:'notice-error',seconds:5,beforeStart:null,onClose:null},panel:{title:'Untitled',width:null,height:null,content:'',onClose:null,closable:true,header:true,overlay:true,clickOver:false,onClickOver:null},tab:{handler:'click',identifier:'.tab',closable:'closable',disabled:'disabled',toolbar:'tab-toolbar',toolbarContainer:'tab-toolbar-container',container:'tab-container',cssHidden:'tab-hidden',cssActive:'tab-active',cssCurrent:'current',cssDisabled:'disabled',fx:true,header:''}}};Js.setup={ext:{validate:function(data){Js.config.ext.validate=Js.append(data,Js.config.ext.validate,['lang'],true);if(Js.on.isset(data.lang))Js.language.ext.validate=Js.append(data.lang,Js.language.ext.validate)}},test:function(data){Js.config.test=Js.append(data,Js.config.test)},util:{buttonSubmit:function(data){Js.config.util.buttonSubmit=Js.append(data,Js.config.util.buttonSubmit)},formSubmit:function(data){Js.config.util.formSubmit=Js.append(data,Js.config.util.formSubmit)},editable:function(data){Js.config.util.editable=Js.append(data,Js.config.util.editable,['lang'],true);if(Js.on.isset(data.lang))Js.language.util.editable=Js.append(data.lang,Js.language.util.editable)}},widget:{activity:function(data){Js.config.widget.activity=Js.append(data,Js.config.widget.activity)},datePicker:function(data){Js.config.widget.datePicker=Js.append(data,Js.config.widget.datePicker,['lang'],true);if(Js.on.isset(data.lang))Js.language.widget.datePicker=Js.append(data.lang,Js.language.widget.datePicker)},dropmenu:function(data){Js.config.widget.dropmenu=Js.append(data,Js.config.widget.dropmenu)},iconizer:function(data){Js.config.widget.iconizer=Js.append(data,Js.config.widget.iconizer)},notice:function(data){Js.config.widget.notice=Js.append(data,Js.config.widget.notice,['lang'],true);if(Js.on.isset(data.lang))Js.language.widget.notice=Js.append(data.lang,Js.language.widget.notice)},panel:function(data){Js.config.widget.panel=Js.append(data,Js.config.widget.panel)},tab:function(data){Js.config.widget.tab=Js.append(data,Js.config.widget.tab)}}};Js.language={ext:{validate:{string:"Require alphanumeric character input",number:"Require numberic input",email:"Require valid e-mail address input",required:"This input field is required",length:"This input field require {type} {value} character.",exact:"exactly",min:"minimum",max:"maximum"}},util:{editable:{message:"Please enter a new option value...",title:"Editable Widget",submitButton:"Ok"}},widget:{datePicker:{selectMonthYear:"Jump to specific month and year",todayButton:"Select Today",prevMonth:"Previous Month",nextMonth:"Next Month",days:["S","M","T","W","T","F","S"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mac","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"]},notice:{titleSuccess:"Congratulation",titleNote:"Note",titleError:"Error has Occur",timer:"This message will automatically close in 5 seconds"},panel:{closeText:"Close"}}};Js.parse={html:{to:function(text){return encodeURIComponent(Js.on.htmlEncode(new String(text)))},from:function(text){return Js.on.htmlDecode(decodeURIComponent(new String(text)))}},xhr:{init:function(json){var that=Js.parse.xhr;var data=eval('('+json+')');Js.debug.log('XHR: '+json);if(Js.on.typeOf(data)=='object'){if(!!data.SUIXHR){that.notice(data);that.href(data);that.update(data);return true}else return false}},notice:function(data){var value=Js.on.pickType(data.notice,'string');if(Js.on.isset(value)&&value!==''){window.alert(value);try{console.log(value)}catch(e){}}},href:function(data){var href=Js.on.pickGrep(data.href,/^https?:\/\//g);var xhref=Js.on.pickGrep(data.xhref,/^https?:\/\//g);if(Js.on.isset(xhref)&&xhref!=='')Js.on.href(xhref,'_blank');else if(Js.on.isset(href)&&href!=='')Js.on.href(href)},update:function(data){var args=Js.on.pick(data.text);var id=Js.on.pickType(data.id,'string');var el=Js.on.pickType(data.selector,'string');var fn=Js.on.pickType(data.callback,'string');if(Js.on.typeOf(args)=='string'){if(!!el)Js.$(el).html(args);else if(!!id)Js.$('#'+id).html(args)}else if(Js.on.isset(fn)){var fn=eval(fn);if(Js.on.isfunction(fn))fn(args)}}}};Js.test={isString:function(value){return(typeof(value)=='string'&&isNaN(value))},isNumber:function(value){return!isNaN(value)},isLength:function(data,value){var result=false;if(data.match(/^(max|min|exact)\-(\d*)$/i)){var type=RegExp.$1;var length=Js.on.toNumber(RegExp.$2);switch(type){case'max':result=value<=length;break;case'min':result=value>=length;break;case'exact':result=value==length;break;default:result=false}}return result},isEmail:function(value){return(value.match(Js.config.test.email))},isURL:function(value){return(value.match(Js.config.test.url))},isIpAddress:function(value){return(value.match(Js.config.test.ip))},isPostcode:function(value){return(value.match(Js.config.test.postcode))}};Js.ext.validate=Js.create({appName:'validate',node:null,first:null,setting:null,language:null,data:"",test:{match:[],compareDate:[]},cacheResult:null,initiate:function(node,option){return(Js.on.isset(node)?this.init(node,option):this)},setup:function(option){var option=Js.on.pickType(option,{},"object");this.setting=Js.append(option,this.setting,["lang"],true);if(Js.on.isset(option.lang))this.language=Js.append(option.lang,this.setting);return this},_prepare:function(){this.setting.errorNode.match(/^(span|div|p|em|label|strong|b|i)\.(.*)$/i);this.setting.error={node:RegExp.$1,cssMessage:RegExp.$2}},init:function(node,option){var that=this;this.node=Js.$(node).eq(0);this.setup(option);this.setting=Js.append(this.setting,Js.config.ext[this.appName]);this.language=Js.append(this.language,Js.language.ext[this.appName]);this._prepare();if(Js.on.isset(this.setting.auto)&&this.setting.auto===true)this.run();return this},run:function(){var that=this;var setting=this.setting;var fnBeforeStart=Js.on.pick(setting.beforeStart,null);var fnSuccess=Js.on.pick(setting.success,null);var fnOnError=Js.on.pick(setting.onError,null);var contRun=true;this.data="";this.first=null;if(Js.on.isfunction(fnBeforeStart)){contRun=fnBeforeStart.apply(this);fnBeforeStart=null}if(contRun===false)return false;if(this.node.length>=1){Js.$(":input",this.node).each(function(i,v){that._validate(v)})}if(Js.on.isset(this.first)){try{this.first.focus()}catch(e){Js.debug.log("Js.ext.form: Cannot trigger onFirstFormError "+e)}if(Js.on.isfunction(fnOnError))fnOnError.apply(this);this.cacheResult=false;return false}else{if(Js.on.isfunction(fnSuccess))fnSuccess.apply(this);this.cacheResult=this.data;return this.data}},_error:function(node,text){var that=this;this.first=(Js.on.isnull(this.first)?node:this.first);this._addErr(node,text)},_data:function(node){var data="";if(node.is(':checkbox, :radio')){if(node.is(':checked'))data+="&"+node.attr('name')+"="+Js.parse.html.to(node.val())}else data+="&"+node.attr('name')+"="+Js.parse.html.to(node.val());return data},_removeErr:function(node){var errSpan=this.setting.errorNode;var errNode=node.siblings(errSpan);if(errNode.length>0)errNode.remove()},_addErr:function(node,message){var that=this;var errorNode=node.siblings(this.setting.errorNode).eq(0);if(errorNode.length<1)Js.$("<"+this.setting.error.node+"/>").addClass(this.setting.error.cssMessage).text(message).insertAfter(node[0]);else errorNode.eq(0).append('<br />'+message);node.bind("change",function(){var jnode=Js.$(this);if(jnode.val()!==""){that._removeErr(jnode);that.first=null}})},_validate:function(field){var that=this;var lang=this.language;var node=Js.$(field);var value=node.val();if(node.attr('name')!=""){that._removeErr(node);var klasses=(!!node.attr('class')?node.attr('class'):"");var klass=klasses.split(/\s/);var error="";if(!!Js.on.inArray("required",klass)&&Js.on.trim(value)==""){error=lang.required}if(Js.on.trim(value)!=""){if(!!Js.on.inArray("string",klass)&&!Js.test.isString(value))error=lang.string;else if(!!Js.on.inArrayGrep(/^(integer|number)$/,klass)&&!Js.test.isNumber(value))error=lang.number;else if(!!Js.on.inArray("email",klass)&&!Js.test.isEmail(value))error=lang.email;var indexLength=Js.on.indexOfGrep(/^(max|min|exact)\-(\d*)$/i,klass);if(indexLength>-1){var types=RegExp.$1;var values=RegExp.$2;if(!Js.test.isLength(klass[indexLength],value.length)){switch(types){case'min':types=lang.min;break;case'max':types=lang.max;break;case'exact':types=lang.exact;break}var note=lang.length;note=note.replace(/{type}/,types);note=note.replace(/{value}/,values);this._error(node,note)}}}var testIndex=Js.on.indexOfGrep(/^(custom)\-(\w*)$/g,klass);if(testIndex>-1){var tester=Js.on.camelize(klass[testIndex]);var validate=this.setting[tester];if(Js.on.isset(validate)){var required=Js.on.pickType(validate.required,false,"boolean");if(required===true&&Js.on.trim(value)==="")error=Js.on.pickType(validate.error,error,"string");if(Js.on.trim(value)!==""){if(Js.on.isfunction(validate.callback)&&!validate.callback(value))error=Js.on.pickType(validate.error,error,"string");else if(validate.regex&&!value.match(validate.regex))error=Js.on.pickType(validate.error,error,"string")}}}Js.debug.log(error);if(error!="")that._error(node,error);this.data+=this._data(node)}}});Js.util.activeContent=Js.create({appName:"activeContent",last:null,interval:null,repeat:false,init:null,element:null,option:null,fnBeforeStart:null,fnSuccess:null,initiate:function(jo){var that=this;var jo=Jrun.pickType(jo,{},"object");this.element=Jrun.pick(jo.element,null);this.fnBeforeStart=Jrun.pick(jo.beforeStart,this.fnBeforeStart);this.fbSuccess=Jrun.pick(jo.success,this.fnSuccess);if(Jrun.isset(this.element)){this._selector();this._check()}else{this.interval=window.setInterval(function(){that._check()},100)}},destroy:function(){if(Jrun.isset(this.interval)){clearInterval(this.interval);this.interval==null}this.element=null;return null},_selector:function(){var that=this;Js.use(this.element).bind("click",function(){var href=Js.use(this).attr("href");var hash=(Jrun.isset(href)?href:this.href);var r;r=(hash.match(/^\#/)?["",hash.substr(1)]:hash.split(/\#/));if(Jrun.isfunction(that.fnBeforeStart))that.fnBeforeStart();if(Jrun.isset(r[1])){that.repeat=(r[1]===that.last);that.last=r[1];that.init(r[1].split(/\//));if(Jrun.isfunction(that.fnSuccess))that.fnSuccess()}})},_check:function(){if(location.hash!=this.last&&location.hash!=="#"){this.last=location.hash;if(Jrun.isfunction(this.fnBeforeStart))this.fnBeforeStart();this.init(location.hash.substr(1).split(/\//));if(Jrun.isfunction(this.fnSuccess))this.fnSuccess()}}});Js.util.buttonSubmit=Js.create({appName:'buttonSubmit',id:null,url:null,button:null,setting:null,handler:'click',formValidate:null,initiate:function(obj){this.id=Js.on.pick(obj.id,null);this.url=Js.on.pick(obj.url,null);this.button=Js.on.pick(obj.button,null);if(!!this.id&&!!this.url&&this.button)this.init(obj.option);return this},setup:function(option){var option=Js.on.pickType(option,{},'object');this.setting=Js.append(option,this.setting);return this},_prepare:function(){this.formValidate=Js.nue(this.setting);this.formValidate.success=this.setting.formSuccess;this.formValidate.onError=this.setting.formError},init:function(obj){var that=this;this.setup(obj);this.setting=Js.append(this.setting,Js.config.util[this.appName]);this._prepare();var method=Js.on.pickGrep(this.setting.method,/^(get|post)$/i);Js.use(this.button).bind(this.handler,function(){var form=new Js.ext.validate(that.id,that.formValidate);var result=form.cacheResult;if(!!result){Js.$.ajax({type:method,url:that.url,data:result,beforeSend:function(){if(Js.on.isfunction(that.setting.beforeSend))that.setting.beforeSend.apply(that)},success:function(reply){var runDefault=true;if(Js.on.isfunction(that.setting.sendSuccess))runDefault=that.setting.sendSuccess.apply(that,[reply]);if(runDefault!==false)Js.parse.xhr.init(reply)},onError:function(){if(Js.on.isfunction(that.setting.onSendError))that.setting.onSendError.apply(that)}})}return false})}});Js.util.dimension={page:{scrolls:{x:function(){var doc=document.body;var result=0;var offset=window.pageXOffset;var elem=document.documentElement;if(typeof(offset)=='number')result=offset;else if(doc&&doc.scrollLeft)result=doc.scrollLeft;else if(elem&&elem.scrollLeft)result=elem.scrollLeft;return result},y:function(){var doc=document.body;var result=0;var offset=window.pageYOffset;var elem=document.documentElement;if(typeof(offset)=='number')result=offset;else if(doc&&doc.scrollTop)result=doc.scrollTop;else if(elem&&elem.scrollTop)result=elem.scrollTop;return result},both:function(){var that=Js.util.dimension.page.scrolls;return[that.x(),that.y()]}},middle:function(weight,height){var doc=document.body,offset=[Js.$(window).width(),Js.$(window).height()],locate=Js.util.dimension.page.scrolls.both();var result=[Math.round(((offset[0]-weight)/2)+locate[0]),Math.round(((offset[1]-height)/2)+locate[1])];result[0]=(result[0]<0?0:result[0]);result[1]=(result[1]<0?0:result[1]);return result.reverse()}},node:{scrolls:{},size:{},offset:function(node){var result=[0,0,0,0];var loop=false;if(Jrun.isset(node)){if(node.offsetParent){loop=true;result[0]=node.offsetWidth;result[1]=node.offsetHeight;while(node.offsetParent){result[2]+=node.offsetTop;result[3]+=node.offsetLeft;node=node.offsetParent}}else{if(loop==false){result[0]=Js.on.pick(node.scrollWidth,0);result[1]=Js.on.pick(node.scrollHeight,0);result[2]=Js.on.pick(node.offsetTop,0);result[3]=Js.on.pick(node.offsetLeft,0)}}return result}else Js.debug.log('Js.util.dimension.node.offset: failed because node does not exist')}}};Js.util.formSubmit=Js.util.buttonSubmit.extend({appName:'formSubmit',handler:'submit',initiate:function(obj){if(Js.on.parameter(arguments,1,['object'])){this.id=Js.on.pick(obj.id,null);this.url=Js.on.pick(obj.url,null)}else if(Js.on.parameter(arguments,2,[true,"string"])){this.id=Js.on.pick(arguments[0],null);this.url=Js.on.pick(arguments[1],null)}this.button=this.id;if(!!this.id&&!!this.url&&this.button)this.init(obj.option);return this}});Js.util.ticker=Js.create({element:null,node:null,initiate:function(elem){return(Jrun.isset(elem)?this.init(selector):this)},init:function(elem){this.element=Jrun.pick(elem,null);if(Jrun.isset(this.element))this.node=Js.use(this.element);return this},tick:function(){this.node.each(function(i,v){v.checked=true})},untick:function(){this.node.each(function(i,v){v.checked=false})},invert:function(){this.node.each(function(i,v){v.checked=!v.checked})}});Js.util.editable=Js.create({appName:"editable",node:null,element:null,box:null,setting:null,language:null,value:null,input:null,cacheData:null,lastSelected:null,initiate:function(elem,opt){return(!!Jrun.isset(elem)?this.init(elem,opt):this)},setup:function(opt){var opt=Jrun.pickType(opt,{},"object");this.setting=Js.append(opt,this.setting,["lang"],true);if(Jrun.isset(opt.lang))this.language=Js.append(opt.lang,this.language);return this},init:function(elem,opt){var that=this;this.element=Jrun.pick(this.element,elem);this.setup(opt);this.setting=Js.append(this.setting,Js.config.util.editable);this.language=Js.append(this.language,Js.language.util.editable);this.node=Js.use(this.element);this.node.bind("change",function(){var node=Js.use(this);if(node.val()==that.setting.identifier)that.getModalBox(this)});this.node.each(function(){if(Js.use(this).val()==that.setting.identifier)this.options[0].selected=true});return this},onModalBoxClose:function(field){var ret=[];Js.use(field).children("option").each(function(i,v){ret.push(Js.use(v).val())});this.cacheData=ret;var updated=false;var runDefault=true;var val=this.input.val();this.value=val;if(Jrun.isfunction(this.setting.onBeforeUpdate))runDefault=this.setting.onBeforeUpdate.apply(this,[field]);if(runDefault!==false&&(Jrun.isset(val)&&Jrun.trim(val)!=""&&!Jrun.inArray(val,ret))){Js.use('<option selected="selected" value="'+val+'">'+val+'</option>').appendTo(field);updated=true}else field.options[0].selected=true;if(Jrun.isfunction(this.setting.onUpdate))this.setting.onUpdate.apply(this,[field,updated])},getModalBox:function(field){var that=this;if(Jrun.isfunction(this.setting.beforeStart))this.setting.beforeStart.apply(this);this.box=new Js.widget.dialog({element:"editable_edit_box_"+Jrun.prep(this.element),title:this.language.title,width:300,height:100,onClose:function(){that.onModalBoxClose(field)},button:[{text:this.language.submitButton,callback:function(){return true},type:"submit"}],language:{closeText:"Cancel"},overlay:this.setting.overlay,clickOver:true,onClickOver:function(){that.input.val("")}});var div=Js.use("<div/>").setClass("panel").appendTo(this.box.content[0]);var p=Js.use("<label/>").htmlText(""+this.language.message).appendTo(div[0]);this.input=Js.use('<input type="text"/>').attr("name","util_editable_"+Jrun.prep(this.element)).val(this.setting.prefix).appendTo(div[0]);var box=this.box;box.closeButton.htmlText("Cancel").bind("click",function(){that.input.val("");box.closePanel()})}});Js.util.includer={script:function(uri){return Js.$('<script/>').attr({'type':'text/javascript','src':uri}).appendTo('head')},style:function(uri,media){var media=Js.on.pickGrep(media,"all",/^(all|print|screen|handheld)$/i);return Js.$("<link/>").attr({'type':'text/css','href':uri,'media':media}).appendTo('head')}};Js.util.smartInput=Js.create({node:null,element:null,initiate:function(elem){var that=this,on_blur=function(){var node=Js.$(this);if(Js.on.trim(node.val())==='')node.val(node.attr('title').toString())},on_focus=function(){var node=Js.$(this);if(node.attr('title')==node.val())node.val('')};this.element=null;this.node=null;this.init=function(elem){var that=that;that.element=Js.on.pick(elem,that.element);that.node=Js.$(that.element);that.activate(on_blur,on_focus)};if(Js.on.isset(elem))this.init(elem);return this},init:function(elem){var that=this;this.element=Js.on.pick(elem,this.elem);this.node=Js.$(this.element);var on_blur=function(){var node=Js.$(this);if(Js.on.trim(node.val())==='')node.val(node.attr('title').toString())};var on_focus=function(){var node=Js.$(this);if(node.attr('title')==node.val())node.val('')};this.activate(on_blur,on_focus);return this},activate:function(){this.node.bind('blur',on_blur).bind('focus',on_focus).val(this.node.attr('title').toString())},deactivate:function(){this.node.unbind("blur",function(){var node=Js.use(this);if(Js.on.trim(node.val())==="")node.val(node.attr("title").toString())}).unbind("focus",function(){var node=Js.use(this);if(node.attr("title")==node.val())node.val("")})}});Js.widget.activity=Js.create({appName:"activity",node:null,element:null,box:null,setting:null,language:null,count:0,initiate:function(elem,opt){return(Jrun.isset(elem)?this.init(elem,opt):this)},setup:function(opt){if(Jrun.typeOf(opt,"object")){this.setting=Js.append(opt,this.setting,["lang"],true);if(Jrun.isset(opt.lang))this.language=Js.append(opt.lang,this.language)}return this},init:function(elem,opt){this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget[this.appName]);this.language=Js.append(this.language,Js.config.widget[this.appName]);this.element=Jrun.pick(elem,this.element);this.node=Js.use(this.element);if(this.node.size()==0){try{this.node=Js.use("<div/>").attr("id",Jrun.prep(this.element)).appendTo("body")}catch(e){Js.debug.error("Js.widget.activity: fail to create elementById '"+this.element+"'")}}this.node.css({background:this.setting.background,zIndex:this.setting.zIndex,display:"none"}).setClass(Jrun.prep(this.setting.identifier)).css("opacity",0.01);return this},activate:function(fn){var opt=this.setting;if(this.count==0){this.node.css("display","block").fadeTo("normal",opt.opacity);var t=Js.util.dimension.page.middle(opt.boxWidth,opt.boxHeight);if(Jrun.isset(this.box)){this.box.css({top:t[0]+"px",left:t[1]+"px"})}}this.count++;if(Jrun.isfunction(fn))fn()},loadImage:function(){var opt=this.setting;this.box=Js.use("<img/>").attr("src",opt.imagePath).css({position:"absolute",width:opt.boxWidth+"px",height:opt.boxHeight+"px",zIndex:(opt.zIndex+1)}).appendTo(this.node[0]);return this},deactivate:function(fn){if(this.count>0){this.node.fadeTo("normal",0,function(){Js.use(this).css("display","none");if(Jrun.isfunction(fn))fn()})}this.count--;this.count=(this.count<0?0:this.count)}});Js.widget.datePicker=Js.create({appName:"datePicker",field:null,value:"",lastDate:null,type:null,box:null,element:null,renderTo:null,content:null,setting:null,language:null,range:null,minDate:null,maxDate:null,status:null,dateObject:new Date,date:null,day:null,month:null,year:null,initiate:function(js){return(Jrun.typeOf(js)==="object"?this.init(js):this)},setup:function(option){var option=Jrun.pickType(option,{},"object");this.setting=Js.append(option,this.setting,["lang"],true);if(Jrun.isset(option.lang))this.language=Js.append(option.lang,this.language)},init:function(js){var that=this;this.setup(js.option);this.setting=Js.append(this.setting,Js.config.widget[this.appName]);this.language=Js.append(this.language,Js.language.widget[this.appName]);this.element=Jrun.prep(Jrun.pick(js.element,this.element));this.renderTo=Jrun.pick(js.renderTo,this.renderTo);if(!this.renderTo||(typeof(this.renderTo)!=="string"&&!this.renderTo.nodeType)){this.renderTo=Js.use("<div/>").appendTo("body")}else if(typeof(this.renderTo)==="string"||this.renderTo.nodeType){this.renderTo=Js.use(this.renderTo).eq(0)}js.range=Jrun.pickType(js.range,this.range,[null,null],"array");this.field=Jrun.pickType(js.field,this.field,"calendar-value","string");this.type=Jrun.pickGrep(js.type,this.type,"single",/^(single|multiple)$/g);if(!!js.minDate&&this.setting.dateFormat.test(js.minDate))this.minDate=Jrun.pick(js.minDate,null);if(!!js.maxDate&&this.setting.dateFormat.test(js.maxDate))this.maxDate=Jrun.pick(js.maxDate,null);if(!!js.value&&js.value.match(this.setting.dateFormat)){js.month=RegExp.$2;js.year=RegExp.$1;js.day=RegExp.$3;this.value=js.value}else if(!!js.value&&js.value==="today"){var tmpdate=new Date();js.month=tmpdate.getMonth();js.year=tmpdate.getFullYear();js.day=tmpdate.getDate();this.value=[js.year,js.month,js.day].join("-")}this.month=((!js.month||isNaN(js.month)||js.month>12||js.month<0)?this.dateObject.getMonth():Math.abs(js.month-1));this.year=((!js.year||isNaN(js.year)||js.year<1000)?this.dateObject.getFullYear():js.year);this.day=Jrun.pick(js.day,this.day);this.date=[this.year,(this.month+1),Jrun.pick(this.day,1)].join("-");this.navigation=Jrun.pick(js.navigate,true);var _getRange=function(data){var ret=null;var year=that.dateObject.getFullYear();if(!data||data.toLowerCase()=="now")ret=year;else if(data.match(/^(\+|\-)?(\d{1,4})$/)){var plus=RegExp.$1;var value=RegExp.$2;if(plus=="+")ret=(year+Jrun.toNumber(value));else if(plus=="-")ret=(year-Jrun.toNumber(value));else ret=value}return ret};if(this.navigation==true){js.range[0]=_getRange(js.range[0]);js.range[1]=_getRange(js.range[1]);if(js.range[0]<js.range[1]){var ret=js.range[0];js.range[0]=js.range[1];js.range[1]=ret;delete ret}this.range=[this.maxYear(js.range[0]),this.minYear(js.range[1])]}if(Jrun.isfunction(this.setting.beforeStart))this.setting.beforeStart.apply(this);this.renderTo.text("");this.status="load";this.box=new Js.widget.dialog({element:[this.element,"calendar"].join("-"),renderTo:this.renderTo[0],title:"",width:350,language:{closeText:"Cancel"},overlay:true});var content=Js.use("<div/>").appendTo(this.box.content[0]);this.option=Js.use("<div/>").addClass("calendar-option").appendTo(content[0]);this.content=Js.use("<div/>").addClass("calendar-content").appendTo(content[0]);this.callback();return this},minYear:function(year){var ret=year;if(this.minDate){var minDate=this.minDate.split("-");var newYear=Jrun.toNumber(minDate[0]);if(newYear>ret)ret=newYear}return ret},maxYear:function(year){var ret=year;if(this.maxDate){var maxDate=this.maxDate.split("-");var newYear=Jrun.toNumber(maxDate[0]);if(newYear<ret)ret=newYear}return ret},prevMonth:function(){this.day=null;this.dateObject=new Date(this.year,(this.month-1));this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),this.dayOfMonth()].join("-");if(this.validation()){this.callback()}else{this.dateObject=new Date(this.year,(this.month+1));this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),"1"].join("-")}return this},prevYear:function(){this.day=null;this.dateObject=new Date((this.year-1),this.month);this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),this.dayOfMonth()].join("-");if(this.validation()){this.callback()}else{this.dateObject=new Date((this.year+1),this.month);this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),"1"].join("-")}return this},nextMonth:function(){this.day=null;this.dateObject=new Date(this.year,(this.month+1));this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),this.dayOfMonth()].join("-");if(this.validation()){this.callback()}else{this.dateObject=new Date(this.year,(this.month-1));this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),"1"].join("-")}return this},nextYear:function(){this.day=null;this.dateObject=new Date((this.year+1),this.month);this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),this.dayOfMonth()].join("-");if(this.validation()){this.callback()}else{this.dateObject=new Date((this.year-1),this.month);this.month=this.dateObject.getMonth();this.year=this.dateObject.getFullYear();this.date=[this.year,(this.month+1),"1"].join("-")}return this},customMonth:function(data){this.day=null;this.dateObject=new Date(this.year,data);var ret=[];ret[0]=this.dateObject.getMonth();ret[1]=this.dateObject.getFullYear();this.date=[ret[1],(ret[0]+1),this.dayOfMonth(ret[0],ret[1])].join("-");if(this.validation()){this.year=ret[1];this.month=ret[0];this.callback()}else{this.dateObject=new Date(this.year,this.month);this.date=[this.year,(this.month+1),"1"].join("-");this.callback()}return this},customYear:function(data){this.day=null;this.dateObject=new Date(data,this.month);var ret=[];ret[0]=this.dateObject.getMonth();ret[1]=this.dateObject.getFullYear();this.date=[ret[1],(ret[0]+1),this.dayOfMonth(ret[0],ret[1])].join("-");if(this.validation()){this.year=ret[1];this.month=ret[0];this.callback()}else{this.dateObject=new Date(this.year,this.month);this.date=[this.year,(this.month+1),"1"].join("-");this.callback()}return this},today:function(){this.dateObject=new Date();this.year=this.dateObject.getFullYear();this.month=this.dateObject.getMonth();this.day=this.dateObject.getDate();this.date=[this.year,(this.month+1),this.day].join("-");this.callback()},validation:function(){var ret=false;var minDate=Jrun.isset(this.minDate);var maxDate=Jrun.isset(this.maxDate);if(minDate&&maxDate&&this.compare(minDate,this.date)&&this.compare(this.date,maxDate))ret=true;else if(minDate&&this.compare(minDate,this.date))ret=true;else if(maxDate&&this.compare(this.date,maxDate))ret=true;else if(!minDate&&!maxDate)ret=true;return ret},dayOfMonth:function(month,year){var month=Jrun.pick(month,this.month);var year=Jrun.pick(year,this.year);if(month==1&&(year%4==0&&year%100!=0)||year%400==0)var monthLength=29;return Jrun.pickType(monthLength,this.setting.daysInMonth[month],"number")},compare:function(first,second){var firsts=first.split("-");var seconds=second.split("-");var firstDate=new Date(firsts[0],(Jrun.toNumber(firsts[1])-1));firstDate.setDate(firsts[2]);var secondDate=new Date(seconds[0],(Jrun.toNumber(seconds[1])-1));secondDate.setDate(seconds[2]);return secondDate>=firstDate},updateValue:function(year,month,day){var field=Js.use("#"+this.element+"_"+year+month+day).eq(0);var calendar=Js.use("#"+this.element+"-"+this.field).eq(0);var months=(month<10?"0"+month:month);var days=(day<10?"0"+day:day);if(this.type=="single"){if(!field.hasClass("calendar-day-selected")){if(Jrun.isset(this.lastDate)&&Js.use("#"+this.element+"_"+this.lastDate).size()>0)var lastdate=Js.use("#"+this.element+"_"+this.lastDate).setClass("calendar-day");field.setClass("calendar-day-selected");this.value=[year,months,days].join("-");calendar.val(this.value);this.lastDate=[year,month,day].join("")}else{field.setClass("calendar-day");calendar.val("")}}else if(this.type=="multiple"){var value=calendar.val();var values=value.split("|");if(Jrun.inArray([year,months,days].join("-"),values)){values.splice(values.indexOf([year,months,days].join("-")),1);value=values.join("|");field.setClass("calendar-day");this.value=value;calendar.val(this.value)}else{field.setClass("calendar-day-selected");values[values.length]=[year,months,days].join("-");this.value=values.join("|");calendar.val(this.value)}}if(Jrun.isfunction(this.setting.onUpdate))this.setting.onUpdate.apply(this);return this},callback:function(){var that=this;this.content.html("");this.option.html("");this.box.title(this.language.months[this.month]+" "+this.year);var first_day=new Date(this.year,this.month,1);var start_day=first_day.getDay();var html="";var monthLength=this.dayOfMonth();var table=Js.use("<table cellpadding='0' cellspacing='0'></table>").addClass("calendar-body").appendTo(this.content[0]);var tbody=Js.use("<tbody/>").appendTo(table[0]);var trheader=Js.use("<tr/>").addClass("calendar-header").appendTo(tbody[0]);for(var i=0;i<=6;i++)Js.use("<td/>").addClass("calendar-header-day").text(this.language.days[i]).appendTo(trheader[0]);var day=1;for(var i=0;i<6;i++){var weeks=Js.use("<tr/>").addClass("calendar-week").appendTo(tbody[0]);for(var j=0;j<=6;j++){this.date=[this.year,(this.month+1),day].join("-");var days=Js.use("<td/>").addClass("calendar-"+(this.validation()?"day":"invalid")).appendTo(weeks[0]);if(day<=monthLength&&(i>0||j>=start_day)){days.attr("id",this.element+"_"+this.year+(this.month+1)+day);var tday;if(this.validation()){days.bind("click",function(){var i=Js.use(this).attr("id").split("_");var count=(i.length-1);var ym=that.year+""+that.month;tday=i[count].substr((ym.length),i[count].length);that.updateValue(that.year,(that.month+1),Jrun.toNumber(tday))})}if(day==this.day){days.setClass("calendar-day-selected");this.lastdate=this.year+""+(this.month+1)+""+Jrun.toNumber(this.day)}days.css("cursor","pointer");days.text(day.toString());day++}else days.htmlText("&nbsp;").setClass("calendar-invalid")}if(day>monthLength)break}if(this.setting.navigation==true){Js.use("<a/>").setClass("prev-month").text(this.language.prevMonth).attr("href","#").click(function(){that.prevMonth();return false}).appendTo(this.content[0]);Js.use("<a/>").setClass("next-month").text(this.language.nextMonth).attr("href","#").click(function(){that.nextMonth();return false}).appendTo(this.content[0]);var selmonth=Js.use("<select name='month'></select>").bind("change",function(){that.customMonth(this.value)}).appendTo(this.option[0]);for(var i=0;i<12;i++){if(this.month==i)Js.use("<option value='"+i+"' selected='selected'></option>").text(this.language.months[i]).appendTo(selmonth[0]);else Js.use("<option value='"+i+"'></option>").text(this.language.months[i]).appendTo(selmonth[0])}var selyear=Js.use("<select name='year'></select>").text(" ").bind("change",function(){that.customYear(this.value)}).appendTo(this.option[0]);for(var i=this.range[0];i>=this.range[1];i--){if(this.year==i)Js.use("<option value='"+i+"' selected='selected'></option>").text(i.toString()).appendTo(selyear[0]);else Js.use("<option value='"+i+"'></option>").text(i.toString()).appendTo(selyear[0])}if(this.status=="initiated")this.box.buttons.html("");this.box.addButton({type:"submit",text:this.language.todayButton,callback:function(){that.today()}})}this.box.fixDimension();this.status="initiated";if(Jrun.isset(this.field)){var input=Js.use("<input id='"+[this.element,this.field].join("-")+"' name='"+this.field+"' type='"+this.setting.fieldType+"' />").appendTo(this.content[0]);if(Jrun.isset(this.day)){var m=(this.month+1);this.value=[this.year,(m<10?"0"+m:m),this.day].join("-");input.val(this.value);this.lastDate=[this.year,(this.month+1),Jrun.toNumber(this.day)].join("")}}return this}});Js.widget.dropmenu=Js.create({node:null,element:null,setting:null,initiate:function(elem,opt){var that=this;var prepare=function(elem,opt){that.element=elem;that.init(opt)};if(Jrun.isset(elem))prepare(elem,opt);return this},setup:function(opt){if(Jrun.typeOf(opt,"object"))this.setting=Js.append(opt,this.setting);return this},init:function(elem,opt){var that=this;this.element=Jrun.pick(elem,this.element);this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget.dropmenu);this.node=Js.use(this.element);if(this.node.size()>0){Js.use("ul, li",this.node[0]).hover(function(){that._show(this)},function(){that._hide(this)});Js.use('li',this.node[0]).hover(function(){Js.use(this).addClass('hover');Js.use('> a',this).addClass('hover')},function(){Js.use(this).removeClass('hover');Js.use('> a',this).removeClass('hover')})}else Js.debug.error("Js.widget.dropdown: No elements found");return this},_show:function(el){var c=this._getChild(el);if(!c)return false;Js.use(c).data('cancelHide',true).css("zIndex",this.setting.zIndex++).fadeIn(this.setting.speed).slideDown(this.setting.speed);if(el.nodeName.toLowerCase()=="ul"){var li=this._getPosition(el);Js.use(li).addClass('hover');Js.use('> a',li).addClass('hover')}},_hide:function(el){var that=this;var c=this._getChild(el);if(!c)return false;var node=Js.use(c).data('cancelHide',false);setTimeout(function(){if(!node.data('cancelHide'))node.slideUp(that.setting.speed)},200)},_getChild:function(el){if(el.nodeName.toLowerCase()=="li"){var c=Js.use("> ul",el);return c.size()>0?c[0]:null}else return el},_getPosition:function(el){return(el.nodeName.toLowerCase()=='ul'?Js.use(el).parents('li')[0]:el)}});Js.widget.iconizer=Js.create({appName:"iconizer",setting:null,initiate:function(opt){return(Jrun.isset(opt)?this.init(opt):this)},setup:function(opt){if(Jrun.typeOf(opt,"object"))this.setting=Js.append(opt,this.setting);return this},init:function(opt){var that=this;this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget[this.appName]);Js.use("*[class*=icon]").each(function(i,v){var node=Js.use(v);var klas=node.attr("className");var klass=klas.split(/ /);for(var i=0;i<klass.length;i++){if(klass[i].match(/^icon(\-append)?\-(left|right)\:(\w*)/g)){var append=RegExp.$1=="-append";var icon=RegExp.$3;var pos=Jrun.pickGrep(RegExp.$2,"left",/^(left|right)$/i);var bg=that.setting.folder+icon+"."+that.setting.fileType;if(!!append){var obj=Js.use("<span/>").css({"display":"block","cssFloat":pos,"width":"16px","height":"16px"}).prependTo(node[0]);if(pos=="left"){obj.css({"background":"url('"+bg+"') no-repeat left","marginRight":"3px"})}else{obj.css({"background":"url('"+bg+"') no-repeat right","marginLeft":"3px"})}}else{var obj=node;if(pos=="left"){obj.css({"background":"url('"+bg+"') no-repeat left center","paddingLeft":"17px"})}else{obj.css({"background":"url('"+bg+"') no-repeat right center","paddingRight":"17px"})}}}}});return this}});Js.widget.panel=Js.create({appName:"panel",node:null,main:null,mainTitle:null,renderTo:null,element:null,setting:null,language:null,header:null,container:null,buttons:null,closeButton:null,minimizeButton:null,content:null,footer:null,status:"normal",initiate:function(opt){return(Jrun.isset(opt)?this.init(opt):this)},setup:function(opt){if(Jrun.typeOf(opt,"object")){this.setting=Js.append(opt,this.setting,["lang"],true);if(Jrun.isset(opt.lang))this.language=Js.append(opt.lang,this.language)}return this},_prepSetting:function(){this.renderTo=Jrun.pick(this.setting.renderTo,"body:eq(0)");this.element=this.setting.element},init:function(opt){var that=this;this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget[this.appName]);this.language=Js.append(this.language,Js.language.widget[this.appName]);this._prepSetting();if(typeof(this.renderTo)==="string"||this.renderTo.nodeType){this.renderTo=Js.use(this.renderTo)}else if(!this.renderTo||!this.renderTo.nodeType){this.renderTo=Js.use("body:eq(0)")}this._loadBorder();this._loadContent();if(Jrun.isset(this.setting.button)){var l=this.setting.button.length;for(var i=0;i<l;i++)this.addButton(this.setting.button[i])}return this},_loadBorder:function(){var that=this;var table=Js.use("<table/>").attr("id",this.element+"_panel").setClass("widget-panel").appendTo(this.renderTo[0]);var tr=[];tr[0]=Js.use("<tr/>").appendTo(table[0]);tr[1]=Js.use("<tr/>").appendTo(table[0]);tr[2]=Js.use("<tr/>").appendTo(table[0]);var dh=[];var dc=[];var df=[];dh[0]=Js.use("<td/>").setClass("tl").appendTo(tr[0][0]).css("opacity",0.7);dh[1]=Js.use("<td/>").setClass("b").appendTo(tr[0][0]).css("opacity",0.7);dh[2]=Js.use("<td/>").setClass("tr").appendTo(tr[0][0]).css("opacity",0.7);dc[0]=Js.use("<td/>").setClass("b").appendTo(tr[1][0]).css("opacity",0.7);dc[1]=Js.use("<td/>").setClass("c").appendTo(tr[1][0]);dc[2]=Js.use("<td/>").setClass("b").appendTo(tr[1][0]).css("opacity",0.7);df[0]=Js.use("<td/>").setClass("bl").appendTo(tr[2][0]).css("opacity",0.7);df[1]=Js.use("<td/>").setClass("b").appendTo(tr[2][0]).css("opacity",0.7);df[2]=Js.use("<td/>").setClass("br").appendTo(tr[2][0]).css("opacity",0.7);this.node=table;this.main=dc[1]},_loadContent:function(){var that=this,opt=this.setting;if(Jrun.isset(opt.width))this.main.css("width",opt.width+"px");this.header=Js.use("<h2/>").addClass("header").appendTo(this.main[0]);if(!opt.header)this.header.hide();this.container=Js.use("<div/>").addClass("content-container").appendTo(this.main[0]);this.footer=Js.use("<div/>").addClass("footer").appendTo(this.main[0]);if(Jrun.isset(opt.height))this.container.css("height",opt.height+"px");this.mainTitle=Js.use("<span/>").addClass("title").text(opt.title).appendTo(this.header[0]);this.buttons=Js.use("<span/>").addClass("button").appendTo(this.footer[0]);this.closeButton=Js.use("<a/>").attr("href","#").text(this.language.closeText).setClass("buttons").appendTo(this.footer[0]);if(!!opt.closable)this.closeButton.addClass("close").click(function(){that.closePanel();return false});else this.closeButton.addClass("button-disabled");this.content=Js.use("<div/>").attr("id",this.element).setClass("content").appendTo(this.container[0]);try{this.content.html(opt.content)}catch(e){this.content.htmlText(opt.content)}if(Jrun.isset(opt.height)&&!!opt.scroll){this.content.css({"height":opt.height+"px","overflow":"auto"})}this.node.show("slow");return this},closePanel:function(){var that=this,opt=this.setting;this.node.fadeOut("slow",function(){if(Jrun.isfunction(opt.onClose))opt.onClose.apply(that);that.node.remove()});return this},title:function(tx){this.mainTitle.html("").text(tx);return this},addButton:function(jo){var that=this;var fn=Jrun.pickType(jo.callback,"function");var tx=Jrun.pickType(jo.text,this.language.defaultButton,"string");var t=Jrun.pickGrep(jo.type,"normal",/^(normal|submit|cancel)$/i);Js.use("<a/>").attr("href","#").click(function(){var runDefault=false;if(Jrun.isfunction(fn))runDefault=fn();if(runDefault===true)that.closePanel();return false}).addClass("buttons").addClass(t).text(tx).appendTo(this.buttons[0])},_fixResize:function(){var opt=this.setting;if(Jrun.isset(opt.height)&&!!opt.scroll){this.content.css({"height":opt.height+"px","overflow":"auto"})}}});Js.widget.dialog=Js.widget.panel.extend({overlay:null,_prepSetting:function(){this.renderTo=Jrun.pick(this.setting.renderTo,"body:eq(0)");this.element=this.setting.element},init:function(opt){var that=this;this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget[this.appName]);this.language=Js.append(this.language,Js.language.widget[this.appName]);this._prepSetting();var opt=this.setting;if(typeof(this.renderTo)==="string"||this.renderTo.nodeType){this.renderTo=Js.use(this.renderTo)}else if(!this.renderTo||!this.renderTo.nodeType){this.renderTo=Js.use("body").eq(0)}if(!!opt.overlay)this.overlay=new Js.widget.activity("#overlay-panel");this._loadBorder();this._loadContent();if(Jrun.isset(opt.button)){for(var i=0;i<opt.button.length;i++)this.addButton(opt.button[i])}if(!!opt.overlay)this.overlay.activate();this.fixDimension();if(!!opt.clickOver&&!!opt.overlay){this.overlay.node.one("click",function(){that.closePanel(opt.onClickOver)})}return this},closePanel:function(fn){var that=this,opt=this.setting;if(!!opt.overlay)this.overlay.deactivate();if(Jrun.isfunction(fn))fn.apply(this);this.node.fadeOut("slow",function(){if(Jrun.isfunction(that.setting.onClose))that.setting.onClose.apply(that);that.node.remove()});return this},fixDimension:function(){var width=(this.main.width()>Jrun.pickType(this.setting.width,0,'number')?this.main.width():this.setting.width);var offset=[width,this.main.height()];var center=Js.util.dimension.page.middle(offset[0],offset[1]);var left=center[1];var top=center[0];left=(left<0?0:left);top=(top<0?0:top);this.node.css({"position":"absolute","top":top+"px","left":left+"px","zIndex":6000})}});Js.widget.notice=Js.widget.activity.extend({appName:"notice",callback:null,node:null,setting:null,language:null,initiate:function(elem,opt){this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget[this.appName]);this.language=Js.append(this.language,Js.language.widget[this.appName]);this.node=this.$super.initiate(elem,{boxWidth:550,boxHeight:0,opacity:0.9});this.node.init();this.node.box=Js.use("<div/>").css({"position":"absolute","width":"550px"}).appendTo(this.$super.node[0])},closeNotice:function(){var that=this;if(Jrun.isfunction(this.callback)){this.callback.apply(this);this.callback=null}this.node.deactivate(function(){that.node.box.text("")})},_domAddNotice:function(v,s){var s=Jrun.pickGrep(s,"note",/^(note|success|error)$/i);var that=this;this.node.box.text("");this.node.activate();var title=this.language[Jrun.camelize("title-"+status)];var tx="";var r=false;if(Jrun.typeOf(v)!="object")title=v;else{title=Jrun.pick(note.title,"");tx=Jrun.pick(note.message,"");r=Jrun.pick(note.sticky,false)}this.node.box.setClass(this.setting['css'+Jrun.toProperCase(s)]);Js.use("<h3/>").text(title).appendTo(this.node.box[0]);if(tx!="")var p=Js.use("<p/>").htmlText(""+tx).appendTo(this.node.box[0]);var span=Js.use("<em/>").text(Js.language.widget.notice.timer).appendTo(this.node.box[0]);this.node.node.one("click",function(){that.closeNotice()});if(r==false){setTimeout(function(){that.closeNotice()},(this.setting.seconds*1000))}},success:function(tx,fn){this.callback=Jrun.pick(fn,null);this._domAddNotice(tx,'success')},note:function(tx,fn){this.callback=Jrun.pick(fn,null);this._domAddNotice(tx,'note')},error:function(tx,fn){this.callback=Jrun.pick(fn,null);this._domAddNotice(tx,'error')}});Js.widget.tab=Js.create({appName:"tab",height:null,toolbar:null,node:null,header:null,element:null,activeTab:null,activeHeader:null,handler:null,status:"off",setting:null,tabs:null,current:"",initiate:function(elem,opt){var that=this;var prepare=function(elem,opt){that.node=Js.use(elem);that.init(opt)};if(!!Jrun.isset(elem))prepare(elem,opt);return this},setup:function(opt){this.setting=Js.append(opt,this.setting);return this},init:function(opt){var that=this;this.setup(opt);this.setting=Js.append(this.setting,Js.config.widget.tab);this.handler=Jrun.pickGrep(this.setting.handler,"click",/^(mouseover|click)$/i);if(this.node.size()>0){this.node.addClass(this.setting.container);this.element=this.node.eq(0).attr("id");this._addToolbar();this.activateTab("#"+Js.use("."+this.setting.cssHidden+":first",this.node[0]).attr("id"));this.status="on"}else Js.debug.error("Js.widget.tab: No elements found");return this},_addToolbar:function(){var that=this,opt=this.setting;if(Jrun.trim(opt.header)==""){var dv=Js.use("<div/>").attr({className:opt.toolbarContainer,id:[this.element,"toolbar","container"].join("-")}).prependTo(this.node[0])}else{var dv=Js.use(opt.header).addClass(opt.toolbarContainer)}this.toolbar=dv;this.header=Js.use("<ul/>").attr({id:[this.element,"toolbar"].join("-"),className:opt.toolbar}).appendTo(this.toolbar[0]);var c=Js.use(opt.identifier,this.node[0]);c.each(function(i,v){that._addHeader(v);Js.use(v).setClass(opt.cssHidden)});this.tabs=c;this.tabs.css("display","none");Js.use("<div/>").css("display","block").appendTo(dv[0])},_addHeader:function(elem){var that=this,opt=this.setting,node=Js.use(elem);var title=node.attr("title"),c=node.hasClass(opt.closable),d=node.hasClass(opt.disabled);var li=Js.use("<li/>").appendTo(this.header[0]);var a=Js.use("<a/>").attr({href:"#"+node.attr("id"),title:title}).appendTo(li[0]);Js.use("<em/>").appendTo(a[0]);a.text(title);if(!!c){Js.use("<span/>").css("paddingLeft","10px").text("x").click(function(){var my=Js.use(this.parentNode).click(function(){return false});var h=my.attr("href");that.activeHeader.removeClass();that.activeTab.setClass(opt.hidden);Js.use(h).remove();Js.use(this.parentNode.parentNode).remove();that.revert();return false}).appendTo(a[0])}if(!!d){a.setClass(opt.cssDisabled).bind(this.handler,function(){return false})}else{a.bind(this.handler,function(){that.activateTab(Js.use(this).attr("href"));return false})}},enableTab:function(el){var that=this;Js.use("a[href="+el+"]",this.header[0]).removeClass().unbind(this.handler).bind(this.handler,function(){that.activateTab(Js.use(this).attr("href"));return false});return false},disableTab:function(el){var that=this;Js.use("a[href="+el+"]",this.header[0]).setClass(this.setting.cssDisabled).unbind(this.handler).bind(this.handler,function(){return false});return false},activateTab:function(el){var el=el,that=this,opt=this.setting;var fn=function(){if(Jrun.isset(that.activeHeader))that.activeHeader.removeClass(opt.cssCurrent);that.activeHeader=Js.use("a[href="+el+"]",that.header[0]);that.activeTab=Js.use(el);that.activeHeader.addClass(opt.cssCurrent);that.activeTab.setClass(opt.cssActive);if(!!opt.fx)that.activeTab.slideDown("normal");else that.activeTab.show();that.current=el};if(this.current!==el){if(Jrun.isset(this.activeTab)){this.activeTab.setClass(opt.cssHidden);if(!!opt.fx){this.activeTab.slideUp("normal",function(){fn()})}else{this.activeTab.hide();fn()}}else fn()}return false},revert:function(){var v=Js.use("li > a",this.header[0]);if(v.size()>0)this.activateTab(v.attr("href"))},showTab:function(){if(this.status=="off"){this.toolbar.show();this.tabs.setClass(this.setting.cssHidden);this.activeTab.setClass(this.setting.cssActive)}this.status="on"},hideTab:function(){if(this.status=="on"){this.toolbar.hide();this.tabs.setClass(this.setting.cssActive)}this.status="off"},toggle:function(){this.status=="off"?this.showTab():this.hideTab()},addTab:function(jo){var that=this;if(!!jo.id&&Jrun.typeOf(jo.id)==="string"){var title=Jrun.pick(jo.title,"Untitled");var id=jo.id;var tx=Jrun.pick(jo.content,"");var c=Jrun.pick(jo.closable,false);var set=Jrun.pick(jo.activate,false);var node=Js.use('<div/>').attr({id:id,className:this.setting.cssHidden,title:title}).css("display","none").htmlText(tx).appendTo(this.node[0]);this.tabs.add(node[0]);var li=Js.use('<li/>').appendTo(this.header[0]);var a=Js.use('<a/>').attr({href:"#"+id,title:title}).appendTo(li[0]);Js.use("<em/>").appendTo(a[0]);a.text(title).bind(this.handler,function(){that.activateTab(Js.use(this).attr("href"));return false});if(!!c){Js.use("<span/>").click(function(){var h=Js.use(this.parentNode).attr("href");that.activeHeader.removeClass();that.activeTab.setClass(that.setting.hidden).fadeOut("normal",function(){Js.use(this).remove()});Js.use(h).remove();Js.use(this.parentNode.parentNode).remove();that.revert();return false}).css("paddingLeft","10px").text("x").appendTo(a[0])}if(!!set)this.activateTab("#"+id)}return this}});